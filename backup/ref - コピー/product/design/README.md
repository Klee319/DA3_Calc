# Minecraft RPG ダメージ計算ツール 仕様書

**バージョン**: 1.0
**最終更新日**: 2025-11-22
**作成者**: Claude（based on answer.txt）

## 概要

本ディレクトリには、Minecraft RPG ダメージ計算ツールの詳細な仕様書が格納されています。
この仕様書は、開発者がユーザーの求めるプロダクトを正確に実装できるよう、すべての機能・計算式・データ構造を明確に定義しています。

## 仕様書構成

### 基本仕様書

| No | ファイル名 | 内容 | ページ数 |
|:---:|:---|:---|---:|
| 01 | [01_システム概要.md](./01_システム概要.md) | ツール全体の目的、3つのページ構成、UI仕様、用語集 | 7KB |
| 02 | [02_ステータスシステム.md](./02_ステータスシステム.md) | 全ステータスの定義、計算フロー、装備・職業・紋章・ルーンの統合 | 13KB |
| 03 | [03_装備システム.md](./03_装備システム.md) | 武器・防具・アクセ・紋章・ルーン・リングの詳細仕様 | 13KB |
| 04 | [04_職業SPシステム.md](./04_職業SPシステム.md) | SP獲得方法、SPツリー、職業レベル成長、解法スキル | 12KB |
| 05 | [05_ダメージ計算.md](./05_ダメージ計算.md) | 武器種別ダメージ計算式、会心率・会心ダメージ、最終ダメージ | 15KB |
| 06 | [06_スキルシステム.md](./06_スキルシステム.md) | 職業スキル、武器スキル、スキルレベル、MP計算 | 11KB |
| 07 | [07_その他システム.md](./07_その他システム.md) | 食べ物バフ、リング、耐性、DPS/TTK計算 | 10KB |
| 08 | [08_データ構造.md](./08_データ構造.md) | CSV/YAML構造、データ読み込みフロー、拡張性 | 16KB |

### 補足資料

| ファイル名 | 内容 |
|:---|:---|
| [追加質問事項.md](./追加質問事項.md) | 実装前に確認すべき質問事項（優先度付き） |
| [rule.md](./rule.md) | 元の機能要件定義（参考資料） |

## 読み方ガイド

### 初めて読む方
1. **01_システム概要.md**: まずはここから全体像を把握
2. **02_ステータスシステム.md**: 計算の核となるステータスの仕組みを理解
3. 必要に応じて個別のシステム仕様書を参照

### 開発者向け
- **フロントエンド開発者**: 01, 02, 03, 04を重点的に
- **計算ロジック開発者**: 02, 05, 06を重点的に
- **データ管理開発者**: 08を重点的に

### QAエンジニア向け
- すべての仕様書を通読
- バリデーション項目に注目

## 重要な仕様のハイライト

### 撃力 = 会心ダメージ
- **撃力**はユーザーの所持する**会心ダメージ**に相当
- 内部的には`UserCritDamage`として扱う
- 詳細: 02_ステータスシステム.md の1.2.1

### 武器ランクの逆算
- CSVの最低ランクが指定されている場合、Fランクの値を逆算する必要がある
- 詳細: 03_装備システム.md の2.2.3

### SPツリーの並行進行
- A/B/C系統は同時進行可能
- 各系統内では上から順に取得する必要がある
- 詳細: 04_職業SPシステム.md の3.2

### 会心率の計算
```
会心率 = 武器会心率 + 器用さ × 0.3
```
- 詳細: 05_ダメージ計算.md の4.1

### 食べ物バフは1つのみ
- 複数同時選択不可
- 固定値として加算（%補正ではない）
- 詳細: 07_その他システム.md の1.4

### 耐性は火力計算に不使用
- 耐性は自分の被ダメージ軽減用
- 火力計算（敵へのダメージ）には考慮しない
- 詳細: 07_その他システム.md の3.3

## データソース

本ツールは以下のデータから情報を読み込みます:

### CSVデータ（`/data/csv/`）
- 装備: 武器、防具、アクセサリー、紋章、ルーンストーン、食べ物
- 職業: ノービス、プリースト、ウィザードなど

### YAMLデータ（`/data/formula/`）
- 計算式: WeaponCalc、UserStatusCalc、SkillCalc
- 定数: EqConst、JobConst

詳細: 08_データ構造.md

## 計算式の参照先

### ステータス計算
```
BaseStatus = (SumEquipment + Job.Initial×Lv + Job.SP + Food + UserOption)
             × (1 + Job.Bonus/100 + Emblem.Bonus/100)
```
- 参照: 02_ステータスシステム.md の2.7

### 武器ダメージ計算（剣）
```
BaseDamage = (WeaponAttackPower + UserPower × 1.6)
             × DamageCorrection
             × (1 + (WeaponCritDamage/100) + UserCritDamage × 0.005)
```
- 参照: 05_ダメージ計算.md の2.1.1

### 最終ダメージ
```
FinalDamage = (HitDamage - (EnemyDefence/2))
              × (1 - EnemyTypeResistance/100)
              × (1 - EnemyAttributeResistance/100)
```
- 参照: 05_ダメージ計算.md の5.1

## 実装時の注意点

### 1. 計算順序の厳守
- 装備ステータス → 職業ステータス → 基礎ステータス → リング収束
- 詳細: 02_ステータスシステム.md の2.1

### 2. YAML計算式のパース
- `<Level>`, `<JobLevel>`などの変数置換が必要
- 四則演算、関数（round, floor, ln, max, minなど）のサポート
- 詳細: 06_スキルシステム.md の10.1

### 3. データ検証
- CSVの必須カラム、データ型、参照整合性のチェック
- 詳細: 08_データ構造.md の4.2

### 4. エラーハンドリング
- データ読み込みエラー、計算エラーの適切な処理
- ユーザーへの明確なエラーメッセージ
- 詳細: 各仕様書の「バリデーション」セクション

## 拡張性の考慮

### 新規データの追加
- **新規装備**: CSVに行を追加するのみ
- **新規職業**: 職業CSVとJobConst.yamlに定義を追加
- **新規スキル**: SkillCalc.yamlに定義を追加

### 新規機能の追加
- **リング**: 未実装だが仕様は考慮済み
- **装備図鑑**: 将来的な拡張として想定
- **ビルド保存・共有**: 将来的な拡張として想定

詳細: 01_システム概要.md の4章、08_データ構造.md の6章

## よくある質問（FAQ）

### Q: 撃力とは何ですか?
A: ユーザーの会心ダメージに相当するステータスです。内部的には`UserCritDamage`として扱います。

### Q: ルーンストーンは何個まで装備できますか?
A: 各グレード（ノーマル、グレート、バスター、レプリカ）から1個ずつ、合計最大4個です。

### Q: 食べ物バフは複数選択できますか?
A: いいえ、1つのみ選択可能です。

### Q: 耐性は火力計算に影響しますか?
A: いいえ、耐性は自分の被ダメージ軽減用なので、火力計算（敵へのダメージ）には使用しません。

### Q: 会心率はどう計算されますか?
A: `会心率 = 武器会心率 + 器用さ × 0.3` で計算されます。

## 未解決の質問

実装を進める上で、さらに詳細な確認が必要な項目を「追加質問事項.md」にまとめています。
優先度別に整理されているため、実装前に確認してください。

特に以下の項目は高優先度です:
- 職業初期値のレベル成長詳細
- 武器ランク逆算の詳細
- アクセサリーの計算式（Forge）
- スキルの未定義パラメータ
- 武器種対応CSVの構造
- 探索範囲の制約
- 探索アルゴリズム

## 改訂履歴

| 版 | 日付 | 変更内容 | 担当者 |
|:---|:---|:---|:---|
| 1.0 | 2025-11-22 | 初版作成（answer.txtベース） | Claude |

## 連絡先・フィードバック

仕様に関する質問や不明点がある場合は、プロジェクトオーナーに確認してください。

---

**注意**: この仕様書は「What（何を作るか）」を定義するものであり、「How（どう作るか）」にあたる技術選定やアーキテクチャ設計は範囲外です。
