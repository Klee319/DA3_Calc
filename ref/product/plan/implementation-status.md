# 実装状況レポート (Implementation Status Report)
**最終更新日**: 2025-11-25
**バージョン**: v0.5.0

---

## 1. プロジェクト概要

Minecraft RPG ダメージ計算機は、ユーザが装備構成やスキルを設定し、ダメージやステータスを検証・最適化するための Web アプリケーションです。

**技術スタック**:
- Next.js 15 (App Router)
- React 19
- TypeScript
- Tailwind CSS
- Zustand (状態管理)

---

## 2. 実装済みページ (Pages)

### 2.1 ページ一覧

| ページパス | ファイル名 | 完成度 | 説明 |
|-----------|-----------|--------|------|
| `/` | `src/app/page.tsx` | 60% | トップページ (Hero セクションのみ) |
| `/build` | `src/app/build/page.tsx` | 70% | ビルド編集画面 (職業選択・SP割り振り・装備スロット) |
| `/damage` | `src/app/damage/page.tsx` | 50% | ダメージ計算画面 (敵入力・スキル選択・結果表示) |
| `/optimize` | `src/app/optimize/page.tsx` | 30% | 最適装備探索画面 (枠のみ実装) |

### 2.2 テストページ

| ページパス | 用途 | 備考 |
|-----------|------|------|
| `/test-data` | データローダーのテスト表示 | 開発用 |
| `/test-loader` | CSV/YAMLローダーの動作確認 | 開発用 |

---

## 3. 実装済みコンポーネント (Components)

### 3.1 コンポーネント一覧 (12個)

| コンポーネント名 | ファイルパス | 完成度 | 主な機能 |
|----------------|-------------|--------|---------|
| **JobSelector** | `src/components/JobSelector.tsx` | 80% | 職業選択ドロップダウン |
| **LevelInput** | `src/components/LevelInput.tsx` | 90% | レベル入力 (数値入力+スライダー) |
| **SPSlider** | `src/components/SPSlider.tsx` | 75% | SP割り振りスライダー (A/B/Cライン) |
| **EquipmentSlot** | `src/components/EquipmentSlot.tsx` | 65% | 装備スロット選択UI (武器・防具・アクセ) |
| **StatViewer** | `src/components/StatViewer.tsx` | 85% | 最終ステータス表示 (HP/Power/Magic等) |
| **CustomSelect** | `src/components/CustomSelect.tsx` | 90% | 汎用プルダウン選択UI |
| **DamageResult** | `src/components/DamageResult.tsx` | 70% | ダメージ計算結果表示 |
| **EnemyInput** | `src/components/EnemyInput.tsx` | 60% | 敵ステータス入力フォーム |
| **SkillSelector** | `src/components/SkillSelector.tsx` | 50% | スキル選択UI (未完成) |
| **NumberInput** | `src/components/ui/NumberInput.tsx` | 95% | 数値入力汎用コンポーネント |
| **Toggle** | `src/components/ui/Toggle.tsx` | 95% | ON/OFFトグルスイッチ |
| **Tooltip** | `src/components/ui/Tooltip.tsx` | 90% | ツールチップ表示 |

---

## 4. 実装済み計算ロジック (Calculation Logic)

### 4.1 statusCalculator (5関数)

| 関数名 | 完成度 | 機能 |
|--------|--------|------|
| `calculateBaseStats()` | 90% | 職業・レベルによる基礎ステータス計算 |
| `calculateSPBonus()` | 70% | SP割り振りによるステータス上昇 |
| `calculateEquipmentStats()` | 60% | 装備ステータス合算 |
| `calculateFinalStats()` | 75% | 最終ステータス統合 |
| `applyPercentageModifiers()` | 50% | % 補正適用 (未完成) |

**完成度**: **70%**

### 4.2 damageCalculator (10関数)

| 関数名 | 完成度 | 機能 |
|--------|--------|------|
| `calculateBaseDamage.Sword()` | 85% | 剣の基礎ダメージ計算 |
| `calculateBaseDamage.Staff()` | 85% | 杖の基礎ダメージ計算 |
| `calculateBaseDamage.Bow()` | 85% | 弓の基礎ダメージ計算 |
| `calculateBaseDamage.Axe()` | 80% | 斧の基礎ダメージ計算 |
| `calculateBaseDamage.GreatSword()` | 80% | 大剣の基礎ダメージ計算 |
| `calculateBaseDamage.Dagger()` | 80% | 短剣の基礎ダメージ計算 |
| `calculateBaseDamage.Spear()` | 75% | 槍の基礎ダメージ計算 |
| `calculateCriticalDamage()` | 70% | 会心ダメージ補正 |
| `calculateAdditionalAttacks()` | 50% | 追撃計算 (一部実装) |
| `applyDamageCorrection()` | 80% | ダメージ補正適用 |

**完成度**: **77%**

### 4.3 equipmentCalculator

| 関数名 | 完成度 | 機能 |
|--------|--------|------|
| `calculateWeaponRank()` | 80% | 武器ランク計算 |
| `calculateArmorStats()` | 85% | 防具ステータス計算 (ARMOR式) |
| `calculateArmorEX()` | 95% | 防具EXステータス計算 |
| `calculateAccessoryStats()` | 85% | アクセサリステータス計算 |
| `calculateAccessoryEX()` | 95% | アクセサリEXステータス計算 |
| `calculateEmblemStats()` | 90% | 紋章ステータス計算 |
| `calculateRuneStats()` | 90% | ルーンストーン計算 |

**完成度**: **89%**

### 4.4 jobCalculator

| 関数名 | 完成度 | 機能 |
|--------|--------|------|
| `getJobBaseStats()` | 85% | 職業基礎ステータス取得 |
| `calculateLevelGrowth()` | 80% | レベル成長計算 |
| `calculateSPAllocation()` | 65% | SP割り振り計算 |
| `getUnlockedSkills()` | 50% | 解放済みスキル一覧取得 |

**完成度**: **70%**

### 4.5 optimize (最適装備探索)

| 関数名 | 完成度 | 機能 |
|--------|--------|------|
| `generateEquipmentCombinations()` | 20% | 装備組み合わせ列挙 (枠のみ) |
| `evaluateBuildDamage()` | 40% | ビルド評価 |
| `findOptimalBuild()` | 10% | 最適解探索 (未実装) |

**完成度**: **23%**

---

## 5. データローダー (Data Loaders)

### 5.1 csvLoader

| 機能 | 完成度 | 対応CSV |
|------|--------|---------|
| 武器データ読み込み | 90% | `DA_EqCalc_Data - 武器.csv` |
| 防具データ読み込み | 90% | `DA_EqCalc_Data - 防具.csv` |
| アクセサリデータ読み込み | 90% | `DA_EqCalc_Data - アクセサリー.csv` |
| 紋章データ読み込み | 90% | `DA_EqCalc_Data - 紋章.csv` |
| ルーンストーンデータ読み込み | 90% | `DA_EqCalc_Data - ルーンストーン.csv` |
| 食べ物データ読み込み | 90% | `DA_EqCalc_Data - 食べ物.csv` |
| 職業CSVデータ読み込み | 65% | 各職業CSV |

**完成度**: **86%**

### 5.2 yamlLoader

| 機能 | 完成度 | 対応YAML |
|------|--------|----------|
| 装備定数読み込み | 80% | `EqConst.yaml` |
| 職業定数読み込み | 75% | `JobConst.yaml` |
| ユーザステータス計算式読み込み | 60% | `UserStatusCalc.yaml` |
| 武器計算式読み込み | 70% | `WeaponCalc.yaml` |
| スキル計算式読み込み | 50% | `SkillCalc.yaml` |

**完成度**: **67%**

---

## 6. ストア (State Management)

### 6.1 buildStore (Zustand)

| 状態 | 完成度 | 説明 |
|------|--------|------|
| `job` | 90% | 選択中の職業 |
| `level` | 95% | 職業レベル |
| `spAllocation` | 80% | SP割り振り (A/B/Cライン) |
| `equipment` | 90% | 装備一式 (武器・防具・アクセ・EX対応) |
| `food` | 90% | 食事設定 (ON/OFF切り替え対応) |
| `ring` | 30% | 指輪バフ (未完成) |
| `selectedSkill` | 50% | 選択中スキル |
| `enemyStats` | 60% | 敵ステータス |
| `finalStats` | 90% | 最終ステータス (EX・食事・ルーン統合済み) |
| `emblem` | 90% | 紋章 (%補正対応) |
| `runestones` | 90% | ルーンストーン (グレード制限対応) |

**完成度**: **78%**

---

## 7. 機能別完成度サマリー

| カテゴリ | 機能 | 完成度 | 備考 |
|---------|------|--------|------|
| **UI/UX** | トップページ | 60% | Hero セクションのみ |
| | ビルド編集画面 | 85% | タブ構造完成、EX選択UI追加 |
| | ダメージ計算画面 | 50% | スキル選択UI未完成 |
| | 最適装備探索画面 | 30% | 実装ほぼなし |
| **計算ロジック** | 職業ステータス計算 | 70% | SP計算が不完全 |
| | 武器ランク計算 | 80% | 基本実装済み |
| | 防具計算 (ARMOR式) | 95% | EX計算完成 |
| | アクセサリ計算 | 95% | EX計算完成 |
| | 紋章計算 | 90% | %補正対応完成 |
| | ルーンストーン計算 | 90% | グレード制限対応完成 |
| | 食事計算 | 90% | ON/OFF切り替え対応完成 |
| | 通常攻撃ダメージ | 80% | 主要武器種対応 |
| | スキルダメージ | 50% | 一部スキルのみ |
| | 追撃計算 | 40% | 枠のみ |
| **データ管理** | CSVローダー | 86% | 紋章・ルーン・食事対応完成 |
| | YAMLローダー | 67% | 式評価が不完全 |
| | Zustand ストア | 78% | EX・ルーン・食事統合完成 |
| **最適化** | 装備探索エンジン | 10% | ほぼ未実装 |

**プロジェクト全体の完成度**: **約 75%**

---

## 8. 未実装機能リスト

### 8.1 高優先度 (High)

- [x] 防具EXステータス計算の完全実装 ✅ 2025-11-25完了
- [x] アクセサリEXステータス計算の実装 ✅ 2025-11-25完了
- [x] ルーンストーンシステムの完全実装 ✅ 2025-11-25完了
- [x] 食事システムの完全実装 ✅ 2025-11-25完了
- [x] 紋章ステータス計算の完成 ✅ 2025-11-25完了
- [ ] 職業SP割り振りの詳細UI (スキル解放表示)
- [ ] スキルダメージ計算の拡充 (主要スキル100個以上)
- [ ] 装備選択時のバリデーション

### 8.2 中優先度 (Medium)

- [ ] 武器追撃システムの完全実装 (22種類)
- [ ] 指輪バフシステム
- [ ] 最適装備探索アルゴリズム
- [ ] Hit数・マルチヒット対応
- [x] 防具の叩き回数とランク選択UI ✅ 実装済み
- [ ] 敵ステータス・属性耐性システム
- [ ] Local Storage による永続化
- [ ] ナビゲーションヘッダー

### 8.3 低優先度 (Low)

- [ ] DPS計算機能
- [ ] ケルベロス武器等の特殊能力
- [ ] 耐性システムの拡張
- [ ] プログレスバー (最適化実行時)
- [ ] エラーハンドリングの強化
- [ ] パフォーマンス最適化
- [ ] モバイル対応の最適化

---

## 9. 次のマイルストーン (Next Milestones)

### Phase 1 (完成度 70% → 85%) - 推定期間: 3週間

1. 防具・アクセサリのEX計算完全実装
2. ルーンストーン・食事システムの実装
3. SP割り振りUIの強化 (スキル解放表示)
4. スキルダメージ計算の拡充 (主要30スキル対応)
5. タブ構造の実装 (ビルド編集画面)

### Phase 2 (完成度 85% → 95%) - 推定期間: 2週間

1. 武器追撃システムの実装
2. 最適装備探索の基本アルゴリズム実装
3. バリデーション強化
4. Local Storage 永続化
5. デザインシステムの本格適用

### Phase 3 (完成度 95% → 100%) - 推定期間: 1週間

1. DPS計算機能の実装
2. 特殊武器能力の実装
3. エラーハンドリング強化
4. パフォーマンス最適化
5. モバイル対応の調整

---

## 10. 既知の問題・技術的負債

### 10.1 重要度: 高

- **YAML式評価エンジンの不完全性**: 複雑な計算式が正しく評価できない場合がある
- **型安全性の不足**: 一部のデータローダーで型チェックが不十分
- **エラーハンドリングの欠如**: CSV/YAML読み込み失敗時の処理が不完全

### 10.2 重要度: 中

- **パフォーマンス**: 大量の装備組み合わせ計算時に遅延する可能性
- **UI状態管理**: Zustand の状態が肥大化する懸念
- **テストカバレッジ**: 単体テストが不足 (現在約30%)

### 10.3 重要度: 低

- **コードの重複**: 計算ロジックの一部に重複コードあり
- **コメント不足**: 複雑な計算式の説明不足
- **デザインの不統一**: 一部コンポーネントでデザインシステム未適用

---

## 11. リソース・依存関係

### 11.1 完成済みリソース

- ✅ CSV データファイル (武器・防具・アクセ・紋章・ルーン・食事)
- ✅ 仕様書 (spec-equipment-calc.md, spec-skill-damage.md, spec-ui-flow.md)
- ✅ デザインシステム (modanui.md)
- ✅ プレースホルダーマッピング (spec-placeholder-mapping.md)

### 11.2 未完成リソース

- ⚠️ YAML 設定ファイル (EqConst.yaml, UserStatusCalc.yaml 等) - 60%
- ⚠️ 職業CSVファイル - 70%
- ⚠️ スキル計算式YAML (SkillCalc.yaml) - 40%

---

## 12. チーム・開発体制への推奨事項

本プロジェクトは **並列開発** を前提に設計されています。以下の分担が推奨されます:

### 12.1 推奨役割分担

| 担当 | 主な作業内容 | 依存関係 |
|------|-------------|---------|
| **フロントエンドA** | UI/UXコンポーネント開発 | デザインシステム |
| **フロントエンドB** | タブ構造・ナビゲーション実装 | UIコンポーネント |
| **バックエンドA** | 計算ロジック (装備・ステータス) | YAML設定ファイル |
| **バックエンドB** | 計算ロジック (ダメージ・スキル) | CSV・YAMLデータ |
| **データエンジニア** | CSV/YAMLデータ整備・検証 | 仕様書 |
| **アルゴリズムエンジニア** | 最適装備探索エンジン | 計算ロジック完成後 |

### 12.2 並列開発のキーポイント

- **インターフェース定義の厳守**: TypeScript の型定義を先に確定
- **モックデータの活用**: 計算ロジック未完成でもUI開発が進められる
- **モジュール境界の明確化**: `lib/calc/` と `components/` は独立開発可能
- **定期的な統合テスト**: 週1回の結合テストを推奨

---

## 13. 修正済みバグリスト (Bug Fixes)

### 13.1 2025-11-25 修正分

| Bug ID | 概要 | 修正ファイル | 状態 |
|--------|------|-------------|------|
| BUG-001 | 力に攻撃力加算バグ | `equipmentCalculator.ts` | ✅ 完了 |
| BUG-002 | 防具強化で無関係ステータス上昇 | `EquipmentSlot.tsx` | ✅ 完了 |
| BUG-003 | アクセサリー強化表示削除 | `EquipmentSlot.tsx` | ✅ 完了 |
| BUG-004 | 足装備の撃力問題 | `equipmentCalculator.ts` | ✅ 完了 |
| BUG-005 | 装備ステータスが最終ステータスに反映されない | `buildStore.ts` | ✅ 完了 |
| BUG-006 | EquipmentSlot防具計算式の不一致 | `EquipmentSlot.tsx:306-326` | ✅ 完了 |
| BUG-007 | ステータス内訳表示の誤り | `buildStore.ts:71-94` | ✅ 完了 |

### 13.2 修正詳細

#### BUG-006: EquipmentSlot防具計算式の不一致
- **問題**: EquipmentSlotで使用していた簡易式 `baseValue * rankMultiplier * 0.1` と equipmentCalculator の正しいYAML式が不一致
- **修正前**: DEF 52→94（ランク +42）と誤表示
- **修正後**: DEF 52→60（ランク +8）と正しく表示
- **修正内容**:
  ```typescript
  // 正しいYAML式を適用
  const calculatedValue = Math.round(
    baseWithTataki * (1 + Math.pow(baseWithTataki, 0.2) * (rankMultiplier / availableLv))
  );
  ```

#### BUG-007: ステータス内訳表示の誤り
- **問題**: `convertToUIStats` が `calcStats.base`（全ステータスの合計）を使用していた
- **修正**: `calcStats.breakdown?.jobInitial`（職業ステータスのみ）を使用するように変更
- **結果**: 基本値が職業ステータスのみを表示、装備補正が正しく分離表示

---

## 14. 最新の実装状況サマリー (2025-11-25)

### 14.1 完了した機能

| 機能 | 完成度 | 備考 |
|------|--------|------|
| **職業選択・レベル入力** | 95% | ほぼ完成 |
| **武器ステータス計算** | 90% | ランク・叩き・強化対応済み |
| **防具ステータス計算** | 95% | YAML式・EX計算完成 |
| **アクセサリステータス計算** | 95% | EX計算完成 |
| **紋章ステータス計算** | 90% | %補正対応完成 |
| **ルーンストーン計算** | 90% | グレード制限対応完成 |
| **食事システム** | 90% | ON/OFF切り替え対応完成 |
| **最終ステータス表示** | 95% | EX・食事・ルーン統合済み |
| **通常攻撃ダメージ計算** | 85% | 弓対応確認済み |
| **タブUI構造** | 85% | 7タブ実装済み、EX選択UI追加 |

### 14.2 残存する主要課題

| 優先度 | 機能 | 推定工数 |
|--------|------|---------|
| ~~High~~ | ~~防具EXステータス計算~~ | ~~10h~~ ✅完了 |
| ~~High~~ | ~~アクセサリEXステータス計算~~ | ~~8h~~ ✅完了 |
| ~~High~~ | ~~ルーンストーンシステム~~ | ~~30h~~ ✅完了 |
| ~~High~~ | ~~食事システム~~ | ~~17h~~ ✅完了 |
| ~~High~~ | ~~紋章ステータス計算~~ | ~~14h~~ ✅完了 |
| Medium | 指輪バフシステム | 8h |
| Medium | 武器追撃システム | 40h |
| Medium | スキルダメージ計算 | 60h |
| Low | 最適装備探索 | 60h |

### 14.3 更新後のプロジェクト完成度

**プロジェクト全体の完成度**: **約 75%** (前回65%から +10%)

---

## 15. 2025-11-25 実装完了サマリー

### 15.1 本日実装した機能

| 機能 | 実装内容 | 変更ファイル |
|------|----------|-------------|
| **防具EXステータス** | EX1/EX2選択UI、係数テーブル、計算ロジック統合 | EquipmentSlot.tsx, buildStore.ts |
| **アクセサリEXステータス** | EX選択UI（1つ）、計算ロジック統合 | EquipmentSlot.tsx, buildStore.ts |
| **ルーンストーンシステム** | グレード別選択UI、重複制限、ステータス加算 | RunestoneSlot.tsx, buildStore.ts, data.ts, csvLoader.ts |
| **食事システム** | FoodData型更新、ON/OFF切り替え、ステータス加算 | data.ts, csvLoader.ts, build/page.tsx, buildStore.ts |
| **紋章システム** | name プロパティ追加、%補正計算統合 | data.ts, csvLoader.ts, buildStore.ts |

### 15.2 EXステータス計算式

```
EX実数値 = ROUND(使用可能Lv × ランクEX係数 + 1)
```

**ランクEX係数テーブル** (仕様書§4.1準拠):

| カテゴリ | SSS | SS | S | A/B | C/D | E/F |
|---------|-----|----|----|-----|-----|-----|
| 器用 | 0.15 | 0.13 | 0.11 | 0.09 | 0.07 | 0.05 |
| 撃力/素早さ | 0.6 | 0.5 | 0.4 | 0.3 | 0.2 | 0.1 |
| その他 | 0.7 | 0.6 | 0.5 | 0.4 | 0.3 | 0.2 |

### 15.3 ビルド確認結果

- **npm run build**: ✅ 成功
- **TypeScript型エラー**: なし
- **コードレビュー**: 問題なし

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025-11-25 | v0.5.0 | 防具EX・アクセサリEX・ルーンストーン・食事・紋章システム完成、完成度75%へ |
| 2025-11-25 | v0.4.0 | バグ修正7件追加、完成度65%へ |
| 2025-11-24 | v0.3.0 | 初版作成 |

---

**次のアクション**:
1. 指輪バフシステムの実装
2. 武器追撃システムの実装
3. スキルダメージ計算の拡充
4. `implementation-plan.md` を参照して、Phase 2 のタスクを進める
